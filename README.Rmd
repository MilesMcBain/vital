---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# vital  <img src="man/figures/vital-hex.png" align="right" width = 150 />

<!-- badges: start -->
[![R-CMD-check](https://github.com/robjhyndman/vital/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/robjhyndman/vital/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

The goal of vital is to allow analysis of demographic data using tidy tools.

## Installation

You can install the **stable** version from
[CRAN](https://cran.r-project.org/package=vital):

```r
pak::pak("vital")
```

You can install the **development** version from
[Github](https://github.com/robjhyndman/vital):

``` r
pak::pak("robjhyndman/vital")
```

## Example


```{r example}
library(vital)
library(dplyr)
library(ggplot2)

# Examples using Victorian females
vic_female <- aus_mortality |>
  filter(State == "Victoria", Sex == "female")

# Lifetable in 2000
vic_female |>
  filter(Year == 2000) |>
  life_table()

# Life expectancy
vic_female |>
  life_expectancy() |>
  ggplot(aes(x = Year, y = ex)) +
  geom_line()

# Smoothed data
vic_female |>
  filter(Year == 2000) |>
  smooth_mortality(Mortality) |>
  autoplot(Mortality) +
  geom_line(aes(y = .smooth), col = "blue") +
  ylab("Mortality rate") +
  scale_y_log10()

# Lee-Carter model
lc <- vic_female |>
  model(lee_carter = LC(log(Mortality)))
report(lc)

autoplot(lc)

# Forecasts from Lee-Carter model
lc |>
  forecast(h = 20) |>
  autoplot() +
  ylab("Mortality rate") +
  scale_y_log10()

# Coherent forecasts from FDM model
nor <- norway_mortality |>
  dplyr::filter(Sex != "Total") |>
  collapse_ages() 
fit <- nor |> 
  smooth_mortality(Mortality) |> 
  make_pr(.smooth) |>
  model(hby = FDM(log(.smooth), coherent = TRUE))
fc <- fit |>
  forecast(h = 20) |>
  undo_pr(.smooth)
nor |> 
  filter(Year > 1950) |> 
  ggplot(aes(x = Age, y = Mortality, group = Year)) +
  facet_grid(. ~ Sex) +
  geom_line(color = "grey") +
  scale_y_log10() +
  geom_line(data = fc, aes(y = .mean, color = Year)) +
  scale_color_gradientn(colors = rainbow(25))
```
